<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NHT Tipping</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="font-family: Arial; text-align: center; padding: 40px;">
  <h2>ğŸª™ NEW HEAVEN TOKEN Tip</h2>
  <p>MetaMaskã«æ¥ç¶šã—ã¦ã€NHTã‚’é€é‡‘ã—ã‚ˆã†ï¼</p>

  <button id="connectButton">ğŸ”Œ MetaMask æ¥ç¶š</button>
  <div id="walletAddress" style="margin: 10px 0; font-weight: bold;"></div>

  <input type="text" id="recipient" placeholder="é€ã‚Šå…ˆã‚¢ãƒ‰ãƒ¬ã‚¹" style="width: 300px; padding: 10px; margin-top: 20px;"><br>
  <input type="text" id="amount" placeholder="é‡‘é¡ï¼ˆNHTï¼‰" style="width: 300px; padding: 10px; margin-top: 10px;"><br>
  <input type="text" id="message" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰" style="width: 300px; padding: 10px; margin-top: 10px;"><br>

  <button id="tipButton" style="margin-top: 20px; padding: 10px 20px;">ğŸš€ é€é‡‘ã™ã‚‹</button>
  <p id="status" style="margin-top: 20px; color: green;"></p>

  <script>
    const contractAddress = "0x001b215d0d7bca5B5F1fefFF431c2799B8656e08"; // â†ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹
    const abi = [
      "function tip(address recipient, uint256 amount, string memory message) external"
    ];

    let signer;

    document.getElementById("connectButton").onclick = async () => {
      if (window.ethereum) {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("walletAddress").innerText = `æ¥ç¶šä¸­: ${address}`;
      } else {
        alert("MetaMaskãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚");
      }
    };

    document.getElementById("tipButton").onclick = async () => {
      const recipient = document.getElementById("recipient").value;
      const amount = document.getElementById("amount").value;
      const message = document.getElementById("message").value;
      if (!signer || !recipient || !amount) {
        alert("å¿…è¦ãªæƒ…å ±ãŒè¶³ã‚Šã¾ã›ã‚“ã€‚å…¨ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      const contract = new ethers.Contract(contractAddress, abi, signer);
      const decimals = ethers.BigNumber.from("1000000000000000000"); // 18æ¡
      const amountWithDecimals = ethers.BigNumber.from(amount).mul(decimals);

      try {
        const tx = await contract.tip(recipient, amountWithDecimals, message);
        document.getElementById("status").innerText = "â³ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é€ä¿¡ä¸­...";
        await tx.wait();
        document.getElementById("status").innerText = "âœ… é€é‡‘å®Œäº†ï¼";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "âŒ é€é‡‘ã«å¤±æ•—ã—ã¾ã—ãŸ";
      }
    };
  </script>
</body>
</html>